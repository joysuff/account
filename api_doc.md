# 记账系统 API 文档

## 目录

- [用户管理](#用户管理)
  - [用户注册](#用户注册)
  - [用户登录](#用户登录)
  - [获取用户信息](#获取用户信息)
- [分类管理](#分类管理)
  - [获取分类列表](#获取分类列表)
  - [新增分类](#新增分类)
  - [修改分类](#修改分类)
  - [删除分类](#删除分类)
- [记账管理](#记账管理)
  - [新增账目](#新增账目)
  - [编辑账目](#编辑账目)
  - [删除账目](#删除账目)
  - [查询账目列表](#查询账目列表)
  - [获取账目详情](#获取账目详情)
  - [导出账目记录](#导出账目记录)
- [统计分析](#统计分析)
  - [日统计](#日统计)
  - [月统计](#月统计)
  - [分类统计](#分类统计)
  - [趋势统计](#趋势统计)
- [AI分析](#ai分析)
  - [日账单分析](#日账单分析)
  - [月账单分析](#月账单分析)
  - [近期账单分析](#近期账单分析)

## 通用说明

### 请求格式

- 请求体为json的接口需要在请求头中添加`Content-Type: application/json`
- 认证接口需在请求头中添加：`Authorization: Bearer {token}`

### 响应格式

所有API响应均为JSON格式，包含以下字段：
成功响应
```json
{
  "code": 200,      // 状态码
  "msg": "成功消息", // 提示信息
  "data": {}        // 返回数据，可能为null
}
```
失败响应
```json
{
  "code": 400,      // 状态码
  "msg": "失败消息", // 提示信息
}
```

### 错误码说明

| 错误码 | 说明 |
| ------ | ---- |
| 200    | 成功 |
| 201    | 创建成功 |
| 400    | 请求参数错误 |
| 401    | 未授权或授权失败 |
| 403    | 权限不足 |
| 404    | 资源不存在 |
| 409    | 资源冲突 |
| 422    | 请求内容错误 |
| 500    | 服务器内部错误 |

## 用户管理

### 用户注册

**接口描述**：注册新用户

**请求方法**：`POST`

**请求路径**：`/register`

**请求参数**：

| 参数名   | 类型   | 必填 | 说明     |
| -------- | ------ | ---- | -------- |
| username | string | 是   | 用户名   |
| password | string | 是   | 用户密码 |

**请求示例**：

```json
{
  "username": "testuser",
  "password": "password123"
}
```

**响应示例**：

```json
{
  "code": 201,
  "msg": "注册成功",
  "data": {
    "userId": 1
  }
}
```

**错误情况**：
- 400: 用户名或密码不能为空
- 409: 用户名已存在
- 500: 注册失败

### 用户登录

**接口描述**：用户登录获取令牌

**请求方法**：`POST`

**请求路径**：`/login`

**请求参数**：

| 参数名   | 类型   | 必填 | 说明     |
| -------- | ------ | ---- | -------- |
| username | string | 是   | 用户名   |
| password | string | 是   | 用户密码 |

**请求示例**：

```json
{
  "username": "testuser",
  "password": "password123"
}
```

**响应示例**：

```json
{
  "code": 200,
  "msg": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

**错误情况**：
- 400: 用户名或密码不能为空
- 401: 用户名或密码错误
- 500: 登录失败

### 获取用户信息

**接口描述**：获取当前登录用户信息

**请求方法**：`GET`

**请求路径**：`/profile`

**请求头**：需要包含授权令牌

**响应示例**：

```json
{
  "code": 200,
  "msg": "获取用户信息成功",
  "data": {
    "id": 1,
    "username": "testuser",
    "created_at": "2025-08-27T12:00:00Z"
  }
}
```

**错误情况**：
- 404: 用户不存在
- 500: 获取用户信息失败

## 分类管理

### 获取分类列表

**接口描述**：获取用户的所有分类

**请求方法**：`GET`

**请求路径**：`/categories`

**请求头**：需要包含授权令牌

**响应示例**：

```json
{
  "code": 200,
  "msg": "获取成功",
  "data": [
    {
      "id": 1,
      "name": "餐饮",
      "type": "expense"
    },
    {
      "id": 2,
      "name": "工资",
      "type": "income"
    }
  ]
}
```

**错误情况**：
- 404: 没有数据
- 500: 获取失败

### 新增分类

**接口描述**：创建新的收支分类

**请求方法**：`POST`

**请求路径**：`/categories`

**请求头**：需要包含授权令牌

**请求参数**：

| 参数名 | 类型   | 必填 | 说明                           |
| ------ | ------ | ---- | ------------------------------ |
| name   | string | 是   | 分类名称                       |
| type   | string | 是   | 分类类型（income或expense）    |

**请求示例**：

```json
{
  "name": "交通",
  "type": "expense"
}
```

**响应示例**：

```json
{
  "code": 200,
  "msg": "添加成功",
  "data": {
    "id": 3,
    "name": "交通",
    "type": "expense"
  }
}
```

**错误情况**：
- 400: 分类名和类型不能为空
- 409: 分类已存在
- 500: 添加失败


### 修改分类

**接口描述**：修改已有分类

**请求方法**：`PUT`

**请求路径**：`/categories/:id`

**请求头**：需要包含授权令牌

**路径参数**：

| 参数名 | 类型   | 必填 | 说明     |
| ------ | ------ | ---- | -------- |
| id     | number | 是   | 分类ID   |

**请求参数**：

| 参数名 | 类型   | 必填 | 说明                           |
| ------ | ------ | ---- | ------------------------------ |
| name   | string | 是   | 分类名称                       |
| type   | string | 是   | 分类类型（income或expense）    |

**请求示例**：

```json
{
  "name": "公共交通",
  "type": "expense"
}
```

**响应示例**：

```json
{
  "code": 200,
  "msg": "修改成功",
  "data": {
    "id": 3,
    "name": "公共交通",
    "type": "expense"
  }
}
```

**错误情况**：
- 400: 分类名称和类型不能为空
- 403: 无权限修改
- 404: 要修改的分类不存在
- 409: 分类名称已存在
- 500: 修改失败或无权限

### 删除分类

**接口描述**：删除指定分类

**请求方法**：`DELETE`

**请求路径**：`/categories/:id`

**请求头**：需要包含授权令牌

**路径参数**：

| 参数名 | 类型   | 必填 | 说明     |
| ------ | ------ | ---- | -------- |
| id     | number | 是   | 分类ID   |

**响应示例**：

```json
{
  "code": 200,
  "msg": "删除成功",
  "data": {
     "id": 14
  }
}
```

**错误情况**：
- 500: 删除失败或无权限

## 记账管理

### 新增账目

**接口描述**：添加新的收支记录

**请求方法**：`POST`

**请求路径**：`/records`

**请求头**：需要包含授权令牌

**请求参数**：

| 参数名      | 类型   | 必填 | 说明                        |
| ----------- | ------ | ---- | --------------------------- |
| category_id | number | 是   | 分类ID                      |
| amount      | number | 是   | 金额                        |
| type        | string | 是   | 类型（income或expense）     |
| date        | string | 是   | 日期（YYYY-MM-DD格式）      |
| remark      | string | 否   | 备注                        |

**请求示例**：

```json
{
  "category_id": 1,
  "amount": 100.50,
  "type": "expense",
  "date": "2025-08-27",
  "remark": "午餐费用"
}
```

**响应示例**：

```json
{
  "code": 200,
  "msg": "添加成功",
  "data": {
    "id": 1
  }
}
```

**错误情况**：
- 400: 参数不完整
- 404: 分类不存在
- 422: 分类类型与账目类型不一致
- 500: 添加失败

### 编辑账目

**接口描述**：修改已有账目记录

**请求方法**：`PUT`

**请求路径**：`/records/:id`

**请求头**：需要包含授权令牌

**路径参数**：

| 参数名 | 类型   | 必填 | 说明     |
| ------ | ------ | ---- | -------- |
| id     | number | 是   | 记录ID   |

**请求参数**：

| 参数名      | 类型   | 必填 | 说明                        |
| ----------- | ------ | ---- | --------------------------- |
| category_id | number | 是   | 分类ID                      |
| amount      | number | 是   | 金额                        |
| type        | string | 是   | 类型（income或expense）     |
| date        | string | 是   | 日期（YYYY-MM-DD格式）      |
| remark      | string | 否   | 备注                        |

**请求示例**：

```json
{
  "category_id": 1,
  "amount": 120.50,
  "type": "expense",
  "date": "2025-08-27",
  "remark": "午餐和下午茶"
}
```

**响应示例**：

```json
{
  "code": 200,
  "msg": "修改成功"
}
```

**错误情况**：
- 400: 参数不完整
- 404: 记录不存在或分类不存在
- 422: 分类类型与账目类型不一致
- 500: 修改失败或无权限

### 删除账目

**接口描述**：删除指定账目记录

**请求方法**：`DELETE`

**请求路径**：`/records/:id`

**请求头**：需要包含授权令牌

**路径参数**：

| 参数名 | 类型   | 必填 | 说明     |
| ------ | ------ | ---- | -------- |
| id     | number | 是   | 记录ID   |

**响应示例**：

```json
{
  "code": 200,
  "msg": "删除成功"
}
```

**错误情况**：
- 500: 删除失败或无权限

### 查询账目列表

**接口描述**：分页查询账目记录

**请求方法**：`GET`

**请求路径**：`/records`

**请求头**：需要包含授权令牌

**查询参数**：

| 参数名   | 类型   | 必填 | 说明                   |
| -------- | ------ | ---- | ---------------------- |
| start    | string | 否   | 开始日期（YYYY-MM-DD） |
| end      | string | 否   | 结束日期（YYYY-MM-DD） |
| page     | number | 否   | 页码，默认1            |
| pageSize | number | 否   | 每页条数，默认10       |

**响应示例**：

```json
{
  "code": 200,
  "msg": "获取成功",
  "data": {
    "total": 25,
    "page": 1,
    "pageSize": 10,
    "totalPages": 3,
    "records": [
      {
        "id": 1,
        "user_id": 1,
        "category_id": 1,
        "amount": 100.50,
        "type": "expense",
        "date": "2025-08-27",
        "remark": "午餐费用",
        "created_at": "2025-08-27T12:00:00Z",
        "category": {
          "id": 1,
          "name": "餐饮",
          "type": "expense"
        }
      },
      // 更多记录...
    ]
  }
}
```

**错误情况**：
- 404: 没有数据
- 500: 获取失败

### 获取账目详情

**接口描述**：获取单条账目记录详情

**请求方法**：`GET`

**请求路径**：`/records/:id`

**请求头**：需要包含授权令牌

**路径参数**：

| 参数名 | 类型   | 必填 | 说明     |
| ------ | ------ | ---- | -------- |
| id     | number | 是   | 记录ID   |

**响应示例**：

```json
{
  "code": 200,
  "msg": "获取成功",
  "data": {
    "id": 1,
    "user_id": 1,
    "category_id": 1,
    "amount": 100.50,
    "type": "expense",
    "date": "2025-08-27",
    "remark": "午餐费用",
    "created_at": "2025-08-27T12:00:00Z",
    "category": {
      "id": 1,
      "name": "餐饮",
      "type": "expense"
    }
  }
}
```

**错误情况**：
- 400: 参数不完整
- 404: 记录不存在
- 500: 获取失败

### 导出账目记录

**接口描述**：导出指定时间范围内的账目记录为CSV文件

**请求方法**：`GET`

**请求路径**：`/records/export`

**请求头**：需要包含授权令牌

**查询参数**：

| 参数名 | 类型   | 必填 | 说明                   |
| ------ | ------ | ---- | ---------------------- |
| start  | string | 是   | 开始日期（YYYY-MM-DD） |
| end    | string | 是   | 结束日期（YYYY-MM-DD） |

**响应**：

返回CSV文件下载，文件名格式为：`records_YYYY-MM-DD_HH-MM-SS.csv`

CSV文件包含以下字段：
- 日期
- 分类
- 金额
- 类型
- 备注

**错误情况**：
- 400: 参数不完整
- 404: 没有数据
- 500: 导出失败

## 统计分析

### 日统计

**接口描述**：获取指定日期的收支统计（含明细和汇总）

**请求方法**：`GET`

**请求路径**：`/statistics/daily`

**请求头**：需要包含授权令牌

**查询参数**：

| 参数名 | 类型   | 必填 | 说明                   |
| ------ | ------ | ---- | ---------------------- |
| date   | string | 是   | 日期（YYYY-MM-DD）     |

**响应示例**：

```json
{
  "code": 200,
  "msg": "获取成功",
  "data": {
    "date": "2025-08-27",
    "income": 1000,
    "expense": 500,
    "balance": 500,
    "records": [
      {
        "id": 1,
        "category_id": 1,
        "amount": 100.50,
        "type": "expense",
        "date": "2025-08-27",
        "remark": "午餐费用",
        "category": {
          "id": 1,
          "name": "餐饮",
          "type": "expense"
        }
      },
      // 更多记录...
    ]
  }
}
```

**错误情况**：
- 400: 缺少日期参数
- 404: 指定日期没有数据
- 500: 获取失败

### 月统计

**接口描述**：获取指定月份的收支总额

**请求方法**：`GET`

**请求路径**：`/statistics/monthly`

**请求头**：需要包含授权令牌

**查询参数**：

| 参数名 | 类型   | 必填 | 说明                |
| ------ | ------ | ---- | ------------------- |
| month  | string | 是   | 月份（YYYY-MM）     |

**响应示例**：

```json
{
  "code": 200,
  "msg": "获取成功",
  "data": {
    "month": "2025-08",
    "income": 5000,
    "expense": 3000,
    "balance": 2000
  }
}
```

**错误情况**：
- 400: 缺少月份参数
- 500: 获取失败

### 分类统计

**接口描述**：获取指定月份按分类的消费占比（饼图数据）

**请求方法**：`GET`

**请求路径**：`/statistics/category`

**请求头**：需要包含授权令牌

**查询参数**：

| 参数名 | 类型   | 必填 | 说明                           |
| ------ | ------ | ---- | ------------------------------ |
| month  | string | 是   | 月份（YYYY-MM）                |
| type   | string | 是   | 类型（income或expense）        |

**响应示例**：

```json
{
  "code": 200,
  "msg": "获取成功",
  "data": [
    {
      "category_id": 1,
      "category_name": "餐饮",
      "amount": 1500,
      "percentage": 50
    },
    {
      "category_id": 3,
      "category_name": "交通",
      "amount": 900,
      "percentage": 30
    },
    {
      "category_id": 4,
      "category_name": "购物",
      "amount": 600,
      "percentage": 20
    }
  ]
}
```

**错误情况**：
- 400: 缺少月份或类型参数
- 404: 指定月份没有数据
- 500: 获取失败

### 趋势统计

**接口描述**：获取近N天收支趋势

**请求方法**：`GET`

**请求路径**：`/statistics/trend`

**请求头**：需要包含授权令牌

**查询参数**：

| 参数名 | 类型   | 必填 | 说明                     |
| ------ | ------ | ---- | ------------------------ |
| days   | number | 否   | 天数，默认7              |

**响应示例**：

```json
{
  "code": 200,
  "msg": "获取成功",
  "data": [
    {
      "date": "2025-08-21",
      "income": 500,
      "expense": 300,
      "balance": 200
    },
    {
      "date": "2025-08-22",
      "income": 0,
      "expense": 400,
      "balance": -400
    },
    // 更多日期数据...
  ]
}
```

**错误情况**：
- 400: 最近天数不能为负数
- 404: 最近指定天数没有数据
- 500: 获取失败

## AI分析

### 日账单分析

**接口描述**：AI分析指定日期的收支情况

**请求方法**：`GET`

**请求路径**：`/analysisDaily`

**请求头**：需要包含授权令牌

**查询参数**：

| 参数名 | 类型   | 必填 | 说明                   |
| ------ | ------ | ---- | ---------------------- |
| date   | string | 是   | 日期（YYYY-MM-DD）     |

**响应格式**：Server-Sent Events (SSE)

**事件类型**：

| 事件类型 | 说明                 | 数据格式                       |
| -------- | -------------------- | ------------------------------ |
| message  | 系统消息             | `{"content": "消息内容"}`      |
| analysis | 分析内容（流式返回） | `{"content": "分析内容片段"}`  |
| error    | 错误信息             | `{"message": "错误信息"}`      |
| end      | 分析结束             | `{"content": "完整分析内容"}`  |

**错误情况**：
- 日期参数缺失：通过error事件返回 `{"message": "日期参数缺失"}`
- 指定日期无数据：通过message事件返回 `{"content": "YYYY-MM-DD日无数据"}`
- 分析失败：通过error事件返回相关错误信息

### 月账单分析

**接口描述**：AI分析指定月份的收支情况

**请求方法**：`GET`

**请求路径**：`/analysisMonthly`

**请求头**：需要包含授权令牌

**查询参数**：

| 参数名 | 类型   | 必填 | 说明                |
| ------ | ------ | ---- | ------------------- |
| month  | string | 是   | 月份（YYYY-MM）     |

**响应格式**：Server-Sent Events (SSE)

**事件类型**：同日账单分析

**错误情况**：
- 月份参数缺失：通过error事件返回 `{"message": "缺少月份参数"}`
- 指定月份无数据：通过message事件返回 `{"content": "YYYY-MM月无收入支出账单"}`
- 分析失败：通过error事件返回相关错误信息

### 近期账单分析

**接口描述**：AI分析最近N天的收支情况

**请求方法**：`GET`

**请求路径**：`/analysisRecent`

**请求头**：需要包含授权令牌

**查询参数**：

| 参数名 | 类型   | 必填 | 说明                     |
| ------ | ------ | ---- | ------------------------ |
| days   | number | 否   | 天数，默认7              |

**响应格式**：Server-Sent Events (SSE)

**事件类型**：同日账单分析

**错误情况**：
- 天数为负数：通过error事件返回 `{"message": "最近天数不能为负数"}`
- 指定天数无数据：通过message事件返回 `{"content": "最近N天无数据"}`
- 分析失败：通过error事件返回相关错误信息
