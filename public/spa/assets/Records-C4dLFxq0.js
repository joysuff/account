import"./request-CVhcPHCR.js";/* empty css                   *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                             *//* empty css                  */import{g as j,e as q,d as A}from"./records-CDyc9Nbs.js";import{_ as I}from"./RecordDialog-D_sMa_gI.js";import{r as f,a as E,p as O,c as Q,o as h,b as m,d as t,w as l,k as G,f as K,T as W,U as X,q as H,V as J,W as Z,g as z,l as p,E as ee,h as te,K as oe,X as ae,Y as ne,x as k,Q as le,n as y,G as se}from"./index-DvUvldwB.js";/* empty css                 */import"./categories-j5FhWZJr.js";const re={class:"records"},ie={class:"page-header"},de={class:"card"},ce={class:"card"},pe={class:"pagination-container"},Se={__name:"Records",setup(ue){const w=f(!1),g=f(!1),b=f(null),_=f([]),C=f([]),n=E({start:"",end:""}),s=E({page:1,pageSize:10,total:0}),D=o=>Number(o).toFixed(2),R=o=>{o&&o.length===2?(n.start=o[0],n.end=o[1]):(n.start="",n.end="")},S=()=>{C.value=[],n.start="",n.end="",s.page=1,i()},i=async()=>{w.value=!0,_.value=[],s.total=0;try{const o={page:s.page,pageSize:s.pageSize};n.start&&(o.start=n.start),n.end&&(o.end=n.end);const{data:e}=await j(o);(e==null?void 0:e.code)===404?(_.value=[],s.total=0):(_.value=e.records||[],s.total=e.total||0)}catch(o){console.error("获取记录失败:",o),_.value=[],s.total=0}finally{w.value=!1}},V=o=>{b.value=o,g.value=!0},B=async o=>{try{await se.confirm("确定要删除这条记录吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await A(o.id),y.success("删除成功"),i()}catch(e){e!=="cancel"&&console.error("删除失败:",e)}},U=async()=>{var o,e;if(!n.start||!n.end){y.warning("请先选择日期范围");return}try{const d=await q({start:n.start,end:n.end}),v=new Blob([d.data],{type:"text/csv"}),r=window.URL.createObjectURL(v),c=document.createElement("a");c.href=r,c.download=`records_${n.start}_${n.end}.csv`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(r),y.success("导出成功")}catch(d){console.error("导出失败:",d),y.error("导出失败: "+(((e=(o=d.response)==null?void 0:o.data)==null?void 0:e.msg)||d.message))}},Y=()=>{g.value=!1,b.value=null,i()};return O(()=>{i()}),(o,e)=>{const d=z("Plus"),v=ee,r=G,c=oe,x=te,M=z("Download"),T=K,u=ae,$=ne,L=Z,P=J,F=X;return h(),Q("div",re,[m("div",ie,[e[6]||(e[6]=m("h1",{class:"page-title"},"账单管理",-1)),t(r,{type:"primary",onClick:e[0]||(e[0]=a=>g.value=!0)},{default:l(()=>[t(v,null,{default:l(()=>[t(d)]),_:1}),e[5]||(e[5]=p(" 添加记录 ",-1))]),_:1})]),m("div",de,[t(T,{model:n,inline:"",class:"filter-form"},{default:l(()=>[t(x,{label:"日期范围"},{default:l(()=>[t(c,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=a=>C.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:R},null,8,["modelValue"])]),_:1}),t(x,null,{default:l(()=>[t(r,{type:"primary",onClick:i},{default:l(()=>[...e[7]||(e[7]=[p("查询",-1)])]),_:1}),t(r,{onClick:S},{default:l(()=>[...e[8]||(e[8]=[p("重置",-1)])]),_:1}),t(r,{type:"success",onClick:U},{default:l(()=>[t(v,null,{default:l(()=>[t(M)]),_:1}),e[9]||(e[9]=p(" 导出 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),m("div",ce,[W((h(),H(L,{data:_.value,stripe:"",style:{width:"100%"},"empty-text":"暂无数据"},{default:l(()=>[t(u,{prop:"date",label:"日期",width:"120"}),t(u,{prop:"category.name",label:"分类",width:"120"}),t(u,{label:"类型",width:"80"},{default:l(({row:a})=>[t($,{type:a.type==="income"?"success":"danger"},{default:l(()=>[p(k(a.type==="income"?"收入":"支出"),1)]),_:2},1032,["type"])]),_:1}),t(u,{label:"金额",width:"120"},{default:l(({row:a})=>[m("span",{class:le(a.type==="income"?"income":"expense")},k(a.type==="income"?"+":"-")+"¥"+k(D(a.amount)),3)]),_:1}),t(u,{prop:"remark",label:"备注","show-overflow-tooltip":""}),t(u,{label:"操作",width:"150",fixed:"right"},{default:l(({row:a})=>[t(r,{type:"primary",size:"small",onClick:N=>V(a)},{default:l(()=>[...e[10]||(e[10]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(r,{type:"danger",size:"small",onClick:N=>B(a)},{default:l(()=>[...e[11]||(e[11]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[F,w.value]]),m("div",pe,[t(P,{"current-page":s.page,"onUpdate:currentPage":e[2]||(e[2]=a=>s.page=a),"page-size":s.pageSize,"onUpdate:pageSize":e[3]||(e[3]=a=>s.pageSize=a),total:s.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:i,onCurrentChange:i},null,8,["current-page","page-size","total"])])]),t(I,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=a=>g.value=a),"record-data":b.value,onSuccess:Y},null,8,["modelValue","record-data"])])}}};export{Se as default};
