import"./request-DPtWsdmB.js";/* empty css                   *//* empty css                     *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                         */import{r as m,a as se,J as I,p as re,c as $,o as g,b as h,d as l,w as o,k as de,T as ie,U as ue,q as z,a2 as me,W as ce,g as F,l as s,E as pe,X as _e,x as c,Y as fe,y as ge,z as ye,A as be,f as ve,h as we,i as he,a0 as Ve,O as S,P as Y,a1 as Ee,fT as ke,I as xe,G as R,n as y}from"./index-B4p3Y3uI.js";import{g as Ce}from"./categories-58bDfnwB.js";import{g as Te,t as $e,a as A,e as Re,d as Be,u as De,c as Me}from"./repayments-Bjrjwq9H.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const qe={class:"repayments"},Ie={class:"page-header"},ze={class:"card"},Fe={class:"expense"},Se={__name:"Repayments",setup(Ye){const V=m(!1),E=m(!1),_=m(!1),B=m([]),D=m([]),b=m(null),v=m(),n=se({item:"",category_id:"",amount:"",day_of_month:1,email:"",enabled:1}),N={item:[{required:!0,message:"请输入项目名称",trigger:"blur"}],category_id:[{required:!0,message:"请选择分类",trigger:"change"}],amount:[{required:!0,message:"请输入金额",trigger:"blur"},{pattern:/^\d+(\.\d{1,2})?$/,message:"请输入正确的金额格式",trigger:"blur"}],day_of_month:[{required:!0,message:"请选择提醒日期",trigger:"change"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},k=I(()=>!!b.value),O=I(()=>D.value.filter(t=>t.type==="expense")),j=t=>Number(t).toFixed(2),L=t=>xe(t).format("YYYY-MM-DD HH:mm:ss"),P=t=>({定时任务未创建:"info",idle:"success",running:"warning",stopped:"danger"})[t]||"info",f=async()=>{V.value=!0;try{const{data:t}=await Te();B.value=t||[]}catch(t){console.error("获取周期支付列表失败:",t)}finally{V.value=!1}},H=async()=>{try{const{data:t}=await Ce();D.value=t||[]}catch(t){console.error("获取分类失败:",t)}},G=t=>{b.value=t,Object.assign(n,{item:t.item,category_id:t.category_id,amount:t.amount,day_of_month:t.day_of_month,email:t.email,enabled:t.enabled}),_.value=!0},J=async t=>{try{await R.confirm(`确定要删除周期支付"${t.item}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Be(t.id),y.success("删除成功"),f()}catch(e){e!=="cancel"&&console.error("删除失败:",e)}},W=async t=>{try{const e=t.enabled?0:1,r=e?"启用":"禁用";await R.confirm(`确定要${r}周期支付"${t.item}"吗？`,`确认${r}`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await $e(t.id,e),y.success(`${r}成功`),f()}catch(e){e!=="cancel"&&console.error("操作失败:",e)}},X=async(t,e)=>{try{let r="",i=null;switch(e){case"execute":r=`确定要执行"${t.item}"的定时任务吗？`,i=()=>Re(t.id);break;case"start":r=`确定要启动"${t.item}"的定时任务吗？`,i=()=>A(t.id,1);break;case"stop":r=`确定要停止"${t.item}"的定时任务吗？`,i=()=>A(t.id,0);break}if(!i)return;await R.confirm(r,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await i(),y.success("操作成功"),f()}catch(r){r!=="cancel"&&console.error("任务操作失败:",r)}},x=()=>{var t;_.value=!1,b.value=null,Object.assign(n,{item:"",category_id:"",amount:"",day_of_month:1,email:"",enabled:1}),(t=v.value)==null||t.clearValidate()},K=async()=>{if(v.value)try{await v.value.validate(),E.value=!0;const t={...n,amount:parseFloat(n.amount)};k.value?(await De(b.value.id,t),y.success("更新成功")):(await Me(t),y.success("添加成功")),x(),f()}catch(t){console.error("提交失败:",t)}finally{E.value=!1}};return re(()=>{f(),H()}),(t,e)=>{const r=F("Plus"),i=pe,u=de,d=_e,M=fe,Q=F("arrow-down"),C=be,Z=ye,ee=ge,te=ce,T=he,p=we,U=Ee,q=Ve,ae=ke,le=ve,oe=me,ne=ue;return g(),$("div",qe,[h("div",Ie,[e[9]||(e[9]=h("h1",{class:"page-title"},"周期性支付管理",-1)),l(u,{type:"primary",onClick:e[0]||(e[0]=a=>_.value=!0)},{default:o(()=>[l(i,null,{default:o(()=>[l(r)]),_:1}),e[8]||(e[8]=s(" 添加周期支付 ",-1))]),_:1})]),h("div",ze,[ie((g(),z(te,{data:B.value,stripe:"",style:{width:"100%"}},{default:o(()=>[l(d,{prop:"item",label:"项目名称",width:"150"}),l(d,{prop:"category.name",label:"分类",width:"120"}),l(d,{label:"金额",width:"120"},{default:o(({row:a})=>[h("span",Fe,"¥"+c(j(a.amount)),1)]),_:1}),l(d,{prop:"day_of_month",label:"每月提醒日",width:"120"},{default:o(({row:a})=>[s(c(a.day_of_month)+"号 ",1)]),_:1}),l(d,{prop:"email",label:"提醒邮箱","show-overflow-tooltip":""}),l(d,{label:"状态",width:"120"},{default:o(({row:a})=>[l(M,{type:a.enabled?"success":"danger"},{default:o(()=>[s(c(a.enabled?"已启用":"已禁用"),1)]),_:2},1032,["type"])]),_:1}),l(d,{label:"任务状态",width:"150"},{default:o(({row:a})=>[l(M,{type:P(a.status)},{default:o(()=>[s(c(a.status),1)]),_:2},1032,["type"])]),_:1}),l(d,{prop:"last_reminded_at",label:"最后提醒时间",width:"180"},{default:o(({row:a})=>[s(c(a.last_reminded_at?L(a.last_reminded_at):"未提醒"),1)]),_:1}),l(d,{label:"操作",width:"300",fixed:"right"},{default:o(({row:a})=>[l(u,{type:"primary",size:"small",onClick:w=>G(a)},{default:o(()=>[...e[10]||(e[10]=[s(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(u,{type:a.enabled?"warning":"success",size:"small",onClick:w=>W(a)},{default:o(()=>[s(c(a.enabled?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),l(ee,{onCommand:w=>X(a,w)},{dropdown:o(()=>[l(Z,null,{default:o(()=>[l(C,{command:"execute"},{default:o(()=>[...e[12]||(e[12]=[s("执行任务",-1)])]),_:1}),l(C,{command:"start"},{default:o(()=>[...e[13]||(e[13]=[s("启动任务",-1)])]),_:1}),l(C,{command:"stop"},{default:o(()=>[...e[14]||(e[14]=[s("停止任务",-1)])]),_:1})]),_:1})]),default:o(()=>[l(u,{type:"info",size:"small"},{default:o(()=>[e[11]||(e[11]=s(" 任务操作",-1)),l(i,{class:"el-icon--right"},{default:o(()=>[l(Q)]),_:1})]),_:1})]),_:1},8,["onCommand"]),l(u,{type:"danger",size:"small",onClick:w=>J(a)},{default:o(()=>[...e[15]||(e[15]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,V.value]])]),l(oe,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=a=>_.value=a),title:k.value?"编辑周期支付":"添加周期支付",width:"500px",onClose:x},{footer:o(()=>[l(u,{onClick:x},{default:o(()=>[...e[17]||(e[17]=[s("取消",-1)])]),_:1}),l(u,{type:"primary",loading:E.value,onClick:K},{default:o(()=>[s(c(k.value?"更新":"添加"),1)]),_:1},8,["loading"])]),default:o(()=>[l(le,{ref_key:"formRef",ref:v,model:n,rules:N,"label-width":"100px"},{default:o(()=>[l(p,{label:"项目名称",prop:"item"},{default:o(()=>[l(T,{modelValue:n.item,"onUpdate:modelValue":e[1]||(e[1]=a=>n.item=a),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),l(p,{label:"分类",prop:"category_id"},{default:o(()=>[l(q,{modelValue:n.category_id,"onUpdate:modelValue":e[2]||(e[2]=a=>n.category_id=a),placeholder:"请选择分类",style:{width:"100%"}},{default:o(()=>[(g(!0),$(S,null,Y(O.value,a=>(g(),z(U,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"金额",prop:"amount"},{default:o(()=>[l(T,{modelValue:n.amount,"onUpdate:modelValue":e[3]||(e[3]=a=>n.amount=a),placeholder:"请输入金额",type:"number",step:"0.01"},{prepend:o(()=>[...e[16]||(e[16]=[s("¥",-1)])]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"每月提醒日",prop:"day_of_month"},{default:o(()=>[l(q,{modelValue:n.day_of_month,"onUpdate:modelValue":e[4]||(e[4]=a=>n.day_of_month=a),placeholder:"请选择提醒日期",style:{width:"100%"}},{default:o(()=>[(g(),$(S,null,Y(31,a=>l(U,{key:a,label:`${a}号`,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"提醒邮箱",prop:"email"},{default:o(()=>[l(T,{modelValue:n.email,"onUpdate:modelValue":e[5]||(e[5]=a=>n.email=a),placeholder:"请输入邮箱地址",type:"email"},null,8,["modelValue"])]),_:1}),l(p,{label:"是否启用",prop:"enabled"},{default:o(()=>[l(ae,{modelValue:n.enabled,"onUpdate:modelValue":e[6]||(e[6]=a=>n.enabled=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},tt=Ue(Se,[["__scopeId","data-v-56d63683"]]);export{tt as default};
