import"./request-Ca-4kpEd.js";/* empty css                   *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                             *//* empty css                  */import{g as A,e as I,d as O}from"./records-BP0fdX-l.js";import{_ as Q}from"./RecordDialog-zu2Bf4yh.js";import{r as _,a as x,p as G,c as K,o as z,b as m,d as t,w as n,k as W,f as X,T as H,U as J,q as Z,V as ee,W as te,g as E,l as p,E as ae,h as oe,K as ne,X as le,Y as se,x as h,Q as re,n as y,G as de}from"./index-Dt_27I2L.js";/* empty css                 */import"./categories-BKLupkKH.js";const ie={class:"records"},ce={class:"page-header"},pe={class:"card"},ue={class:"card"},me={class:"pagination-container"},Be={__name:"Records",setup(ge){const w=_(!1),g=_(!1),b=_(null),f=_([]),C=_([]),l=x({start:"",end:""}),s=x({page:1,pageSize:10,total:0}),D=a=>Number(a).toFixed(2),S=a=>{a&&a.length===2?(l.start=a[0],l.end=a[1]):(l.start="",l.end="")},R=()=>{C.value=[],l.start="",l.end="",s.page=1,d()},d=async()=>{w.value=!0;try{const a={page:s.page,pageSize:s.pageSize,start:l.start||void 0,end:l.end||void 0},e=await A(a);e.code===404?(f.value=[],s.total=0):(f.value=e.data.records||[],s.total=e.data.total||0)}catch(a){console.error("获取记录失败:",a),f.value=[],s.total=0}finally{w.value=!1}},V=a=>{s.pageSize=a,s.page=1,d()},B=a=>{s.page=a,d()},U=a=>{b.value=a,g.value=!0},Y=async a=>{try{await de.confirm("确定要删除这条记录吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O(a.id),y.success("删除成功"),d()}catch(e){e!=="cancel"&&console.error("删除失败:",e)}},M=async()=>{var a,e;if(!l.start||!l.end){y.warning("请先选择日期范围");return}try{const i=await I({start:l.start,end:l.end}),v=new Blob([i.data],{type:"text/csv"}),r=window.URL.createObjectURL(v),c=document.createElement("a");c.href=r,c.download=`records_${l.start}_${l.end}.csv`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(r),y.success("导出成功")}catch(i){console.error("导出失败:",i),y.error("导出失败: "+(((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.msg)||i.message))}},T=()=>{g.value=!1,b.value=null,d()};return G(()=>{d()}),(a,e)=>{const i=E("Plus"),v=ae,r=W,c=ne,k=oe,P=E("Download"),$=X,u=le,L=se,F=te,N=ee,j=J;return z(),K("div",ie,[m("div",ce,[e[6]||(e[6]=m("h1",{class:"page-title"},"账单管理",-1)),t(r,{type:"primary",onClick:e[0]||(e[0]=o=>g.value=!0)},{default:n(()=>[t(v,null,{default:n(()=>[t(i)]),_:1}),e[5]||(e[5]=p(" 添加记录 ",-1))]),_:1})]),m("div",pe,[t($,{model:l,inline:"",class:"filter-form"},{default:n(()=>[t(k,{label:"日期范围"},{default:n(()=>[t(c,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=o=>C.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:S},null,8,["modelValue"])]),_:1}),t(k,null,{default:n(()=>[t(r,{type:"primary",onClick:d},{default:n(()=>[...e[7]||(e[7]=[p("查询",-1)])]),_:1}),t(r,{onClick:R},{default:n(()=>[...e[8]||(e[8]=[p("重置",-1)])]),_:1}),t(r,{type:"success",onClick:M},{default:n(()=>[t(v,null,{default:n(()=>[t(P)]),_:1}),e[9]||(e[9]=p(" 导出 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),m("div",ue,[H((z(),Z(F,{data:f.value,stripe:"",style:{width:"100%"},"empty-text":"暂无数据"},{default:n(()=>[t(u,{prop:"date",label:"日期",width:"120"}),t(u,{prop:"category.name",label:"分类",width:"120"}),t(u,{label:"类型",width:"80"},{default:n(({row:o})=>[t(L,{type:o.type==="income"?"success":"danger"},{default:n(()=>[p(h(o.type==="income"?"收入":"支出"),1)]),_:2},1032,["type"])]),_:1}),t(u,{label:"金额",width:"120"},{default:n(({row:o})=>[m("span",{class:re(o.type==="income"?"income":"expense")},h(o.type==="income"?"+":"-")+"¥"+h(D(o.amount)),3)]),_:1}),t(u,{prop:"remark",label:"备注","show-overflow-tooltip":""}),t(u,{label:"操作",width:"150",fixed:"right"},{default:n(({row:o})=>[t(r,{type:"primary",size:"small",onClick:q=>U(o)},{default:n(()=>[...e[10]||(e[10]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(r,{type:"danger",size:"small",onClick:q=>Y(o)},{default:n(()=>[...e[11]||(e[11]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[j,w.value]]),m("div",me,[t(N,{"current-page":s.page,"onUpdate:currentPage":e[2]||(e[2]=o=>s.page=o),"page-size":s.pageSize,"onUpdate:pageSize":e[3]||(e[3]=o=>s.pageSize=o),total:s.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:V,onCurrentChange:B},null,8,["current-page","page-size","total"])])]),t(Q,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=o=>g.value=o),"record-data":b.value,onSuccess:T},null,8,["modelValue","record-data"])])}}};export{Be as default};
