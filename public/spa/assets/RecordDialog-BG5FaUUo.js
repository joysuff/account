import"./request-DPtWsdmB.js";/* empty css                   *//* empty css                  *//* empty css                     *//* empty css                             *//* empty css                 *//* empty css                     *//* empty css               *//* empty css                  *//* empty css                 */import{r as f,J as g,a as P,I as E,Z as D,p as T,q as x,o as _,w as l,d as r,f as $,h as G,_ as J,$ as K,l as d,a0 as L,c as Z,O as z,P as A,a1 as H,i as Q,K as W,k as X,x as ee,a2 as te,n as C}from"./index-B4p3Y3uI.js";import{g as ae}from"./categories-58bDfnwB.js";import{u as oe,c as le}from"./records-C1eas08k.js";const Ve={__name:"RecordDialog",props:{modelValue:{type:Boolean,default:!1},recordData:{type:Object,default:null}},emits:["update:modelValue","success"],setup(M,{emit:w}){const n=M,y=w,u=f(),p=f(!1),V=f([]),m=g({get:()=>n.modelValue,set:e=>y("update:modelValue",e)}),i=g(()=>!!n.recordData),a=P({type:"expense",category_id:"",amount:"",date:E().format("YYYY-MM-DD"),remark:""}),R={type:[{required:!0,message:"请选择类型",trigger:"change"}],category_id:[{required:!0,message:"请选择分类",trigger:"change"}],amount:[{required:!0,message:"请输入金额",trigger:"blur"},{pattern:/^\d+(\.\d{1,2})?$/,message:"请输入正确的金额格式",trigger:"blur"}],date:[{required:!0,message:"请选择日期",trigger:"change"}]},U=g(()=>V.value.filter(e=>e.type===a.type)),q=()=>{a.category_id=""},B=async()=>{try{const{data:e}=await ae();V.value=e||[]}catch(e){console.error("获取分类失败:",e)}},v=()=>{var e;Object.assign(a,{type:"expense",category_id:"",amount:"",date:E().format("YYYY-MM-DD"),remark:""}),(e=u.value)==null||e.clearValidate()},c=()=>{m.value=!1,v()},F=async()=>{if(u.value)try{await u.value.validate(),p.value=!0;const e={...a,amount:parseFloat(a.amount)};i.value?(await oe(n.recordData.id,e),C.success("记录更新成功")):(await le(e),C.success("记录添加成功")),y("success"),c()}catch(e){console.error("提交失败:",e)}finally{p.value=!1}};return D(()=>n.recordData,e=>{e&&Object.assign(a,{type:e.type,category_id:e.category.id,amount:e.amount,date:e.date,remark:e.remark||""})},{immediate:!0}),D(m,e=>{e&&!i.value&&v()}),T(()=>{B()}),(e,t)=>{const b=K,O=J,s=G,j=H,h=L,k=Q,I=W,S=$,Y=X,N=te;return _(),x(N,{modelValue:m.value,"onUpdate:modelValue":t[5]||(t[5]=o=>m.value=o),title:i.value?"编辑记录":"添加记录",width:"500px",onClose:c},{footer:l(()=>[r(Y,{onClick:c},{default:l(()=>[...t[9]||(t[9]=[d("取消",-1)])]),_:1}),r(Y,{type:"primary",loading:p.value,onClick:F},{default:l(()=>[d(ee(i.value?"更新":"添加"),1)]),_:1},8,["loading"])]),default:l(()=>[r(S,{ref_key:"formRef",ref:u,model:a,rules:R,"label-width":"80px"},{default:l(()=>[r(s,{label:"类型",prop:"type"},{default:l(()=>[r(O,{modelValue:a.type,"onUpdate:modelValue":t[0]||(t[0]=o=>a.type=o),onChange:q},{default:l(()=>[r(b,{label:"income"},{default:l(()=>[...t[6]||(t[6]=[d("收入",-1)])]),_:1}),r(b,{label:"expense"},{default:l(()=>[...t[7]||(t[7]=[d("支出",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(s,{label:"分类",prop:"category_id"},{default:l(()=>[r(h,{modelValue:a.category_id,"onUpdate:modelValue":t[1]||(t[1]=o=>a.category_id=o),placeholder:"请选择分类",style:{width:"100%"}},{default:l(()=>[(_(!0),Z(z,null,A(U.value,o=>(_(),x(j,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(s,{label:"金额",prop:"amount"},{default:l(()=>[r(k,{modelValue:a.amount,"onUpdate:modelValue":t[2]||(t[2]=o=>a.amount=o),placeholder:"请输入金额",type:"number",step:"0.01"},{prepend:l(()=>[...t[8]||(t[8]=[d("¥",-1)])]),_:1},8,["modelValue"])]),_:1}),r(s,{label:"日期",prop:"date"},{default:l(()=>[r(I,{modelValue:a.date,"onUpdate:modelValue":t[3]||(t[3]=o=>a.date=o),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),r(s,{label:"备注",prop:"remark"},{default:l(()=>[r(k,{modelValue:a.remark,"onUpdate:modelValue":t[4]||(t[4]=o=>a.remark=o),type:"textarea",placeholder:"请输入备注（可选）",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}};export{Ve as _};
